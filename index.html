<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    <title>å¥½å¥½å°å®¶ - æˆ‘ä»¬çš„çˆ±çš„å°å±‹</title>
    <link rel="stylesheet" href="styles.css"> 
    <style>
        html, body {
            width: 100%; height: 100%; margin: 0; padding: 0;
            background-color: #E8F7F3;
            font-family: 'DotGothic16', monospace;
            overflow-x: hidden;
        }

        /* 1. ä¼ªè£…å±‚æ ·å¼ */
        #welcome-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            text-align: center;
            position: relative;
            z-index: 1000;
        }

        #welcome-screen h1 {
            font-size: 2.5rem;
            color: #194C4F;
            user-select: none;
        }

        /* å››è§’è§¦å‘å™¨ï¼šé€æ˜ä½†å¯ç‚¹å‡» */
        .corner-trigger {
            position: fixed;
            width: 80px;
            height: 80px;
            z-index: 9999;
            cursor: default;
        }
        #corner-tl { top: 0; left: 0; }
        #corner-tr { top: 0; right: 0; }
        #corner-br { bottom: 0; right: 0; }
        #corner-bl { bottom: 0; left: 0; }

        /* 2. ä¸»å®¹å™¨ï¼šåˆå§‹éšè— */
        #app-container {
             display: none; 
             width: 100%; 
             min-height: 100vh;
             flex-direction: column;
             align-items: center; 
        }

        main { width: 90%; max-width: 800px; }
        .header-top { display: flex; justify-content: space-between; align-items: center; margin: 20px 0; }
        .logout-btn { background-color: #ff9999; border: 2px solid #194C4F; font-size: 0.7rem; padding: 5px 10px; cursor: pointer; }
        
        /* çºªå¿µæ—¥ç‰¹æœ‰æ ·å¼ */
        .add-anniv-form { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px; }
        .anniv-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 2px dashed #5EAFB0;
            background: rgba(255,255,255,0.5); margin-bottom: 5px;
        }
        .days-tag { background: #FFD1DC; padding: 2px 8px; border: 1px solid #194C4F; font-size: 0.8rem; }
    </style>
</head>
<body>
    
    <div id="pixel-background"></div>

    <div id="welcome-screen">
        <div id="corner-tl" class="corner-trigger"></div>
        <div id="corner-tr" class="corner-trigger"></div>
        <div id="corner-br" class="corner-trigger"></div>
        <div id="corner-bl" class="corner-trigger"></div>

        <h1>ğŸ’– å¥½å¥½å°å®¶ ğŸ’–</h1>
        <p>æ¯ä¸€ä¸ªåƒç´ ï¼Œéƒ½æ˜¯æˆ‘ä»¬çš„æ•…äº‹</p>
        <p style="font-size: 0.8rem; color: #999; margin-top: 50px;">Â© 2025 è®°å½•çˆ±ä¸æ—¶å…‰</p>
    </div>

    <div id="app-container"> 
        <header class="pixel-border">
            <div class="header-top">
                <h1>ğŸ  æˆ‘ä»¬çš„ä¸»é¡µ</h1>
                <button onclick="logout()" class="pixel-btn logout-btn">é€€å‡ºå¹¶é”å®š</button>
            </div>
            <nav>
                <a href="index.html" class="nav-item pixel-btn">ä¸»é¡µ</a>
                <a href="memories.html" class="nav-item pixel-btn">å›å¿†å½•</a>
                <a href="quests.html" class="nav-item pixel-btn">ç”œèœœä»»åŠ¡</a>
            </nav>
        </header>

        <main>
            <section id="counter" class="pixel-box">
                <h2>â³ æˆ‘ä»¬åœ¨ä¸€èµ·å·²ç»...</h2>
                <div id="days" class="days-count" style="font-size: 3rem; color: #5EAFB0; font-weight: bold;">000</div>
                <p>å¤©</p>
            </section>

            <section id="anniversary-manager" class="pixel-box">
                <h2>ğŸ“… çºªå¿µæ—¥å€’æ•°æ¸…å•</h2>
                <div class="add-anniv-form">
                    <input type="text" id="anniv-name" placeholder="æƒ³å€’æ•°çš„äº‹..." class="pixel-input">
                    <input type="date" id="anniv-date" class="pixel-input">
                    <button onclick="addAnniversary()" class="pixel-btn primary-btn">æ·»åŠ </button>
                </div>
                <div id="anniv-list"></div>
            </section>

            <section id="message-board" class="pixel-box">
                <h2>âœ‰ï¸ æ‚„æ‚„è¯ä¿¡ç®±</h2>
                <div class="message-input-area">
                    <textarea id="message-input" placeholder="ç•™ä¸‹ä¸€å¥ä»Šå¤©çš„ç”œèœœ..." class="pixel-input"></textarea>
                    <div class="msg-controls" style="display: flex; justify-content: space-between; align-items: center; margin-top: 10px;">
                        <div class="author-selector">
                            <label><input type="radio" name="msg-author" value="me" checked> ğŸ’– æˆ‘</label>
                            <label><input type="radio" name="msg-author" value="other"> ğŸ’™ å¯¹æ–¹</label>
                        </div>
                        <button onclick="postMessage()" class="pixel-btn primary-btn">å‘é€</button>
                    </div>
                </div>
                <div id="messages-container" class="msg-list-container"></div>
            </section>
        </main>

        <footer>
            <p>Â© ä¸“å±æˆ‘ä»¬ä¸¤äººçš„åƒç´ å°å®¶ | 2025</p>
        </footer>
    </div>
    
    <script>
        // --- 1. å››è§’è§£é”é€»è¾‘ ---
        let sequence = [];
        const targetSequence = ['tl', 'tr', 'br', 'bl']; // å·¦ä¸Š, å³ä¸Š, å³ä¸‹, å·¦ä¸‹

        document.querySelectorAll('.corner-trigger').forEach(el => {
            el.onclick = () => {
                const corner = el.id.split('-')[1];
                sequence.push(corner);
                
                // æ£€æŸ¥é¡ºåº
                if (sequence[sequence.length - 1] !== targetSequence[sequence.length - 1]) {
                    sequence = []; // é”™ä¸€ä¸ªå°±é‡ç½®
                    return;
                }

                if (sequence.length === targetSequence.length) {
                    enterHouse();
                    sequence = [];
                }
            };
        });

        // --- 2. æ‹çˆ±å¤©æ•°è®¡ç®— ---
        function updateDays() {
            const daysElement = document.getElementById('days');
            if (!daysElement) return;
            const startDate = new Date("2025-09-19"); // è¿™é‡Œæ”¹ä½ ä»¬çš„æ—¥æœŸ
            const today = new Date();
            const diff = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
            daysElement.innerText = diff > 0 ? diff : 0;
        }

        // --- 3. é¡µé¢åˆ‡æ¢é€»è¾‘ ---
        function enterHouse() {
            sessionStorage.setItem('isHomeOpen', 'true');
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('app-container').style.display = 'flex';
            updateDays();
            // è§¦å‘ script.js é‡Œçš„åˆå§‹åŒ–å‡½æ•°ï¼ˆè¯»å–ç•™è¨€å’Œçºªå¿µæ—¥ï¼‰
            if (typeof init === 'function') {
                init(); 
            } else if (window.loadAnniversaries) {
                window.loadAnniversaries();
                window.loadMessages();
            }
        }

        function logout() {
            sessionStorage.removeItem('isHomeOpen');
            location.reload();
        }

        // --- 4. è‡ªåŠ¨æ£€æŸ¥çŠ¶æ€ ---
        window.onload = () => {
            if (sessionStorage.getItem('isHomeOpen') === 'true') {
                enterHouse();
            }
        };
    </script>
    <script src="script.js"></script> 
</body>
</html>